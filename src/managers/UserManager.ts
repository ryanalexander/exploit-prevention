// Function to fetch mutual guilds

import Discord, { Client, Guild, GuildMember, Snowflake } from "discord.js";
import { Managers } from "../lib/libaries";

type User = {
  id: any;

  guilds: () => Promise<any[]>;
  offenses: () => Promise<any[]>;
};

module.exports = class {
  // @ts-ignore
  constructor(client: Client) {}

  async getUser(
    user: Discord.User | GuildMember | Snowflake | Number
  ): Promise<User> {
    let id =
      user instanceof Discord.User || user instanceof GuildMember
        ? user.id
        : user;

    return {
      id: id,
      guilds: async () => this.getMutualGuilds(id),
      offenses: async () => [],
    };
  }

  async getMutualGuilds(
    user: Discord.User | GuildMember | Snowflake | Number | String
  ): Promise<Guild[]> {
    let id =
      user instanceof Discord.User || user instanceof GuildMember
        ? user.id
        : user;
    return Managers.SQL.getGuildsByUser(id);
  }
};
