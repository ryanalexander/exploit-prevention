import {Utils} from '../lib/libaries';
import {Message} from 'discord.js';

module.exports = class {
    private _commandDir: string;
    private _commands: any[] = [];

    constructor(commandDir: string) {
        this._commandDir = commandDir;
        this._commands = [];

        Utils.files.getFiles(this._commandDir).forEach((file:any) => {
            if(file.path.endsWith(".map"))return;
            this.loadCommand(file.path);
        })
    }

    private loadCommand(command: string):void {
        let e = new (require("../"+command));
        this._commands.push(e);
        console.log(`Command> Loaded command ${e._name} with 0 aliases - ${command}`);
    }

    public handle(message: Message, guild: any) {
        let commandName = message.content.split(" ")[0];
        commandName = commandName.substr(guild.prefix.length,commandName.length);
        let commandModule = this._commands.find(command => command._name == commandName);
        if(commandModule)
            commandModule.handle(message, guild);
    }

    get commandDir(): string {
        return this._commandDir;
    }
}