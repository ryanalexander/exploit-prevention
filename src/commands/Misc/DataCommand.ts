import { Command, Managers } from "../../lib/libaries";
import { GuildMember, Message } from "discord.js";

module.exports = class extends Command {
  constructor() {
    super({
      name: "data",
      aliases: ["foi", "whatdoyoucollect"],
      description: "See what data we have collected on you",
      category: "misc",
      requiredPerms: [],
    });
    this._execute = this.execute;
  }

  async execute(_member: GuildMember, _content: string, _message: Message) {
    try {
      _member.createDM(true);
      if (await Managers.SQL.createFOIRequest(_member.user, _member.guild)) {
        _message.channel.send(
          `${_member}\n\nFreedom of information request has been received and accepted. \nYou will receive a DM within 7 days with all the data we have collected on you._(Normally less than 30 minutes)_`
        );
      } else {
        _message.channel.send(
          `${_member}\n\nFailed to create FOI request. Have you done one in the last 30 days?`
        );
      }
    } catch (e) {
      _message.channel.send(
        "Hmm... I can't DM you, i'll need to be able to DM you to give you this info..."
      );
    }
  }
};
