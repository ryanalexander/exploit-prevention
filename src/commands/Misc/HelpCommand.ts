import { Command } from "../../lib/libaries";
import { GuildMember, Message, MessageEmbed } from "discord.js";
import { getGuildMessage, lang } from "../../lib/LanguageLib";

module.exports = class extends Command {
  constructor() {
    super({
      name: "help",
      aliases: ["h"],
      description: "Help menu",
      category: "misc",
    });
    this._execute = this.execute;
  }

  execute(_member: GuildMember, _content: string, _message: Message) {
    let categories: any = {
      ALL: [
        {
          name: ":hammer_pick: ({BOT_PREFIX})dev",
          type: "COMMAND",
          description: "Dev things",
          hidden: (member: GuildMember) => member.id !== "317236321099710467",
        },
        {
          name: ":tools: ({BOT_PREFIX})settings",
          type: "CATEGORY",
          description: "View all settings",
          // @ts-ignore
          hidden: (member: GuildMember) =>
            !member.permissions.has(["MANAGE_GUILD"]),
        },
        {
          name: ":ticket: ({BOT_PREFIX})invite",
          type: "COMMAND",
          description: "Invite me to your server",
          hidden: () => false,
        },
        {
          name: ":beach_umbrella: ({BOT_PREFIX})support",
          type: "COMMAND",
          description: "Get invite to my support Discord",
          hidden: () => false,
        },
        {
          name: ":hammer: ({BOT_PREFIX})contribute",
          type: "COMMAND",
          description: "Contribute to my Development",
          hidden: () => false,
        },
      ],
    };
    let fields: any[] = [];
    categories.ALL.forEach((command: any) => {
      if (command.hidden(_member) === false)
        fields.push({
          name: command.name,
          value: command.description,
          inline: false,
        });
    });

    _message.channel.send({
      embeds: [
        <MessageEmbed>(
          getGuildMessage(lang.messages.help.menu, this.guild, [], fields)
        ),
      ],
    });
  }
};
