import {Command, Managers} from '../../lib/libaries';
import {GuildMember, Message, MessageEmbed} from 'discord.js';

module.exports = class extends Command {
    constructor() {
        super({
            name: "help",
            aliases: ["h"],
            description: "Help menu",
            category: "misc"
        });
        this._execute = this.execute;
    }

    execute(_member: GuildMember, _content: string, _message: Message) {

        let embed = new MessageEmbed();
        let category = "ALL";
        let categories:any = {
            "ALL": [
                {
                    name: "DEV",
                    type: "COMMAND",
                    description: "Dev things",
                    hidden: (member: GuildMember) => member.user.id === "317236321099710467",
                },
                {
                    name: "SETTINGS",
                    type: "CATEGORY",
                    description: "View all settings",
                    hidden: (member: GuildMember) => member.hasPermission("MANAGE_GUILD"),
                },
                {
                    name: "INVITE",
                    type: "COMMAND",
                    description: "Invite me to your server",
                    hidden: ()=>false
                },
                {
                    name: "SUPPORT",
                    type: "COMMAND",
                    description: "Get invite to my support Discord",
                    hidden: ()=>false
                }
            ]
        };

        embed.setColor(Managers.Config.colours.bot_info);

        if(categories[category] === undefined) {
            embed.setTitle("Something isn't quite right...")
            embed.setDescription(`Unknown category specified '${category}'.\n\n**Valid Options**\n${JSON.stringify(Object.keys(categories))}`)
            embed.setColor(Managers.Config.colours.bot_error);
        }else {

            embed.setTitle(`Help menu for ${category}`)
            embed.setDescription("This includes all Sub-categories & Commands\n\n")

            categories[category].forEach((field: any) => {
                if(!field.hidden(_member))
                    embed.addField((field.type==="CATEGORY"?"> ":"") +field.name, field.description, true)
            })
        }

        _message.channel.send(embed);
    };

}