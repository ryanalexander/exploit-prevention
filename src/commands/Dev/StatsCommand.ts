import { Command, Managers } from "../../lib/libaries";
import { Guild, GuildMember, Message, MessageEmbed } from "discord.js";

module.exports = class extends Command {
  constructor() {
    super({
      name: "botstats",
      aliases: [],
      description: "View bot statistics",
      category: "dev",
    });
    this._execute = this.execute;
  }

  async execute(_member: GuildMember, _content: string, _message: Message) {
    let embed = new MessageEmbed();

    if (_member.user.id !== "317236321099710467") return;

    embed.addField(
      "Total Guilds",
      Managers.DiscordClient.guilds.cache.size + " Servers",
      true
    );
    embed.addField(
      "Total Users",
      Managers.DiscordClient.users.cache.size + " Users",
      true
    );

    embed.addField(
      "Sizes",
      "All the different size-brackets the servers are in",
      false
    );
    embed.addField(
      "Fuck off Very Large Guilds (>50k)",
      Managers.DiscordClient.guilds.cache.filter(
        (guild: Guild) => guild.memberCount > 50000
      ).size + " guilds",
      false
    );
    embed.addField(
      "Very Large Guilds (>20k)",
      Managers.DiscordClient.guilds.cache.filter(
        (guild: Guild) => guild.memberCount > 20000
      ).size + " guilds",
      false
    );

    embed.addField(
      "Large Guilds (>10k)",
      Managers.DiscordClient.guilds.cache.filter(
        (guild: Guild) => guild.memberCount > 10000
      ).size + " guilds",
      false
    );
    embed.addField(
      "Med Guilds (>5 <10k)",
      Managers.DiscordClient.guilds.cache.filter(
        (guild: Guild) => guild.memberCount > 5000 && guild.memberCount < 10000
      ).size + " guilds",
      false
    );
    embed.addField(
      "Small Guilds (<5k)",
      Managers.DiscordClient.guilds.cache.filter(
        (guild: Guild) => guild.memberCount > 1000 && guild.memberCount < 5000
      ).size + " guilds",
      false
    );
    embed.addField(
      "Very Small Guilds (<1k)",
      Managers.DiscordClient.guilds.cache.filter(
        (guild: Guild) => guild.memberCount > 50 && guild.memberCount < 1000
      ).size + " guilds",
      false
    );
    embed.addField(
      "Tiny Guilds (<50)",
      Managers.DiscordClient.guilds.cache.filter(
        (guild: Guild) => guild.memberCount > 10 && guild.memberCount < 50
      ).size + " guilds",
      false
    );
    embed.addField(
      "Basically non-existant Guilds (<10)",
      Managers.DiscordClient.guilds.cache.filter(
        (guild: Guild) => guild.memberCount > 1 && guild.memberCount < 10
      ).size + " guilds",
      false
    );
    embed.addField(
      "No friends you sad cunt (1 member)",
      Managers.DiscordClient.guilds.cache.filter(
        (guild: Guild) => guild.memberCount === 2
      ).size + " guilds",
      false
    );

    if (_content.indexOf("-log") > -1) {
      console.log(JSON.stringify(Managers.DiscordClient.guilds.cache));
    }

    _message.channel.send({ embeds: [embed] });
  }
};
