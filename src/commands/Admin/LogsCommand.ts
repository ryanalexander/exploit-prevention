import {Command} from '../../lib/libaries';
import {GuildMember, Message} from 'discord.js';
import {getGuildMessage, lang} from "../../lib/LanguageLib";

module.exports = class extends Command {
    constructor() {
        super({
            name: "logs",
            aliases: ["logging"],
            description: "Logging utility",
            category: "admin",
            requiredPerms: ["MANAGE_GUILD"],
            requiredModules: ["advancedlogging"]
        });
        this._execute = this.execute;
    }

    private actions:string[] = ['INVITE','JOIN'];

    async execute(_member: GuildMember, _content: string, _message: Message) {

        /**
         * ep!logs -a=invite -code=abc -t=1h
         * ep!logs -a=join -t=1h
         */

        let args = _content.split(" ");
        let action = null;
        let timeframe = 0;
        let code = null;

        args.forEach(arg => {
            let parts = arg.split("=");
            parts[0] = parts[0].substr(1,parts[0].length);
            if(parts.length == 1) return;
            switch(parts[0].toUpperCase()) {
                case "A":
                case "ACTION":
                    action = parts[1].toUpperCase();
                    break;
                case "C":
                case "CODE":
                    code = parts[1];
                    break;
                case "T":
                case "TIME":
                case "TIMEFRAME":
                    timeframe = Number(parts[1]);
                    break;
            }
        })

        if(action === null || this.actions.indexOf(action) > 0) {
            _message.channel.send(getGuildMessage(lang.messages.help.logs, this.guild, []));
            return;
        }else {
            if(action === "INVITE") {
                if(code === null)
                    _message.channel.send(getGuildMessage(lang.messages.help.logs, this.guild, []));
                console.log(`Code is ${code}`);
                console.log(`Time is ${timeframe}`);
                return;
            }else {
                _message.channel.send("Unknown action")
            }
        }
    };

}